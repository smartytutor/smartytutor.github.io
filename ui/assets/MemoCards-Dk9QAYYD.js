import{j as m}from"./jsx-runtime-CkxqCPlQ.js";import{r as v}from"./index-DJO9vBfz.js";import{c as z,a as N,d as V,i as k,e as j,f as q,b as D,g as H}from"./_baseForOwn-CjMoZcZF.js";import{S as C,g as L,h as J,b as O,j as K,k as Q,d as T,e as E}from"./_arrayLikeKeys-CtZSz9VC.js";import{u as X,a as x,e as g}from"./UI-CCDgg16s.js";import{A as B}from"./AnimatedCard-BOzM-9Fa.js";import{m as S,D as _}from"./Deck-0jAS4CtB.js";import{m as $}from"./proxy-Bu-Muats.js";var F=C?C.isConcatSpreadable:void 0;function Y(t){return L(t)||J(t)||!!(F&&t&&t[F])}function Z(t,e,r,a,i){var n=-1,c=t.length;for(r||(r=Y),i||(i=[]);++n<c;){var d=t[n];r(d)?z(i,d):i[i.length]=d}return i}function R(t,e){return function(r,a){if(r==null)return r;if(!O(r))return t(r,a);for(var i=r.length,n=-1,c=Object(r);++n<i&&a(c[n],n,c)!==!1;);return r}}var I=R(N);function ee(t,e){var r=-1,a=O(t)?Array(t.length):[];return I(t,function(i,n,c){a[++r]=e(i,n,c)}),a}function te(t,e){return V(t,e)}function re(t,e){var r=t.length;for(t.sort(e);r--;)t[r]=t[r].value;return t}function se(t,e){if(t!==e){var r=t!==void 0,a=t===null,i=t===t,n=k(t),c=e!==void 0,d=e===null,o=e===e,l=k(e);if(!d&&!l&&!n&&t>e||n&&c&&o&&!d&&!l||a&&c&&o||!r&&o||!i)return 1;if(!a&&!n&&!l&&t<e||l&&r&&i&&!a&&!n||d&&r&&i||!c&&i||!o)return-1}return 0}function ne(t,e,r){for(var a=-1,i=t.criteria,n=e.criteria,c=i.length,d=r.length;++a<c;){var o=se(i[a],n[a]);if(o){if(a>=d)return o;var l=r[a];return o*(l=="desc"?-1:1)}}return t.index-e.index}function ae(t,e,r){e.length?e=j(e,function(n){return L(n)?function(c){return q(c,n.length===1?n[0]:n)}:n}):e=[K];var a=-1;e=j(e,Q(D));var i=ee(t,function(n,c,d){var o=j(e,function(l){return l(n)});return{criteria:o,index:++a,value:n}});return re(i,function(n,c){return ne(n,c,r)})}var ie=T(function(t,e){if(t==null)return[];var r=e.length;return r>1&&E(t,e[0],e[1])?e=[]:r>2&&E(e[0],e[1],e[2])&&(e=[e[0]]),ae(t,Z(e),[])});const ce=(t,e)=>Array.isArray(t)?t.map(e):e(t||""),we=(t,e)=>ce(t,r=>r.replace(/\{(\w+)\}/g,(a,i)=>i in e?String(e[i]):a)),U=t=>t.split(/\s+/).length,be=t=>Array.isArray(t)?t.reduce((e,r)=>e+U(r),0):U(t),de={isEqual:te,gt:(t,e)=>t>e,gte:(t,e)=>t>=e,lt:(t,e)=>t<e,lte:(t,e)=>t<=e,"%":(t,e,r)=>t%e===r},P=(t,e)=>{var l;const{prop:r,value:a}=t,i=t.args||[];let{fn:n}=t,c=!1,d;n.startsWith("!")&&(n=n.slice(1),c=!0);const o=de[n];if(!o)throw new Error(`Predicate fn not found: ${n}`);if(r.startsWith("[")){if(!Array.isArray(e))throw new Error(`Array predicate is used on a non-array context: ${r}`);const f=(l=r.match(/^\[(\w+)\]/))==null?void 0:l[1];if(!f||!e[f])throw new Error(`Invalid predicate aggr: ${String(f)}`);const y=r.replace(`[${f}].`,"");d=e[f](w=>{const b=o(H(w,y),...i,a);return c?!b:b})}else d=o(e[r],a),c&&(d=!d);return d},W=(t,e,r="and")=>{if(r==="and")return t.every(a=>P(a,e));if(r==="or")return t.some(a=>P(a,e));throw new Error(`Invalid predicate join strategy: ${r}`)},A=(t,e)=>t.filter(r=>W(r.predicates,e,r.strategy)),G="data:image/svg+xml,%3csvg%20width='926'%20height='657'%20viewBox='0%200%20926%20657'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20filter='url(%23filter0_f_1_2862)'%3e%3cellipse%20cx='463'%20cy='327'%20rx='339'%20ry='209'%20fill='%2338302B'/%3e%3c/g%3e%3cdefs%3e%3cfilter%20id='filter0_f_1_2862'%20x='0'%20y='-6'%20width='926'%20height='666'%20filterUnits='userSpaceOnUse'%20color-interpolation-filters='sRGB'%3e%3cfeFlood%20flood-opacity='0'%20result='BackgroundImageFix'/%3e%3cfeBlend%20mode='normal'%20in='SourceGraphic'%20in2='BackgroundImageFix'%20result='shape'/%3e%3cfeGaussianBlur%20stdDeviation='62'%20result='effect1_foregroundBlur_1_2862'/%3e%3c/filter%3e%3c/defs%3e%3c/svg%3e",oe=""+new URL("selected-star-CyV0-aIB.svg",import.meta.url).href,le=t=>{const e=["served","faceUp"];return t.elevated&&e.push("elevated"),t.shaking&&e.push("shaking"),e},fe=({onTrigger:t})=>{const e=X(),r=x(s=>s.MemoCards.cards),a=x(s=>s.MemoCards.validMatchers),i=x(s=>s.MemoCards.invalidMatchers),n=x(s=>s.MemoCards.completedMatchers),c=x(s=>s.MemoCards.validate),[d,o]=v.useState(!1),l=r.filter(s=>s.status==="decked"),f=r.filter(s=>s.status==="served"||s.status==="selected"),y=r.filter(s=>s.status==="selected"),w=r.filter(s=>s.status==="discarded"),b=s=>{s.elevated?e(g.actions.lower([s.id])):(e(g.actions.elevate([s.id])),t("elevate",s))};return v.useEffect(()=>{if(c){const s=f.filter(p=>p.status==="selected"),[u]=A(a,s),[h]=A(i,s),[M]=A(n,f.filter(p=>p.status!=="selected"));if(u&&h||!u&&!h)throw new Error("Validation error");u&&e(g.actions.validate(s.map(p=>({id:p.id,correct:!0})))),(h||!M)&&t((u||h).next),h&&e(g.actions.validate(s.map(p=>({id:p.id,correct:!W(h.predicates,[p])})))),setTimeout(()=>{u?(e(g.actions.discard(s.map(p=>p.id))),M&&t(M.next)):e(g.actions.deselect())},2e3),e(g.actions.setState({validate:void 0}))}},[n,e,i,t,f,a,c]),v.useEffect(()=>{o(!0)},[f]),m.jsxs("div",{className:"relative flex h-full w-full px-8 py-20",children:[m.jsxs("div",{className:"relative z-10 flex flex-1 items-center justify-center",children:[m.jsx($.div,{className:"grid grid-cols-4 gap-6 p-10",children:f.reverse().map((s,u)=>s.status==="selected"?m.jsx("div",{},s.id):v.createElement(B,{...s,variants:S,layoutId:s.id,animate:le(s),transition:d?{layout:{delay:u*.2}}:void 0,custom:u,onClick:()=>b(s),onLayoutAnimationComplete:u===f.length?()=>o(!1):void 0,key:s.id,style:d?{zIndex:f.length-u}:void 0}))}),y.length>0&&m.jsxs("div",{className:"absolute inset-0 z-50 flex items-center justify-center gap-x-10",children:[m.jsx($.div,{initial:{opacity:0,scale:.5,rotate:-15},animate:{opacity:1,scale:1,rotate:0,transition:{duration:.6}},className:"absolute -inset-10",style:{background:`url(${oe}) no-repeat center center, url(${G}) no-repeat center center`,mask:`url(${G}) center center`}}),ie(y,s=>s.numeral.count).map((s,u)=>v.createElement(B,{variants:S,...s,animate:["faceUp","selected"],layoutId:s.id,transition:{layout:{duration:.2}},key:u}))]})]}),m.jsxs("div",{className:"flex flex-col justify-between",children:[m.jsx("div",{children:l.length>0&&m.jsx(_,{cards:l})}),m.jsx("div",{children:w.length>0&&m.jsx(_,{variant:"discard",cards:w})})]})]})};fe.__docgenInfo={description:"",methods:[],displayName:"MemoCards"};export{fe as M,be as c,we as i,A as m};

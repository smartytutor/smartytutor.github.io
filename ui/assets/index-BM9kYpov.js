import{n as l,c as h,a as R}from"./redux-toolkit.modern-DEr0YuQG.js";import{r as d}from"./index-DRjF_FHU.js";import{m as $,e as J,b as Q,i as X,f as L,g as D,h as Y}from"./_arrayLikeKeys-BOaknIRz.js";var N={exports:{}},V={};/**
 * @license React
 * use-sync-external-store-with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var b=d;function Z(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var ee=typeof Object.is=="function"?Object.is:Z,te=b.useSyncExternalStore,ie=b.useRef,se=b.useEffect,ne=b.useMemo,re=b.useDebugValue;V.useSyncExternalStoreWithSelector=function(e,t,i,s,n){var r=ie(null);if(r.current===null){var a={hasValue:!1,value:null};r.current=a}else a=r.current;r=ne(function(){function o(u){if(!m){if(m=!0,v=u,u=s(u),n!==void 0&&a.hasValue){var p=a.value;if(n(p,u))return f=p}return f=u}if(p=f,ee(v,u))return p;var x=s(u);return n!==void 0&&n(p,x)?(v=u,p):(v=u,f=x)}var m=!1,v,f,S=i===void 0?null:i;return[function(){return o(t())},S===null?void 0:function(){return o(S())}]},[t,i,s,n]);var c=te(e,r[0],r[1]);return se(function(){a.hasValue=!0,a.value=c},[c]),re(c),c};N.exports=V;var ae=N.exports;function oe(e){e()}function ce(){let e=null,t=null;return{clear(){e=null,t=null},notify(){oe(()=>{let i=e;for(;i;)i.callback(),i=i.next})},get(){const i=[];let s=e;for(;s;)i.push(s),s=s.next;return i},subscribe(i){let s=!0;const n=t={callback:i,next:null,prev:t};return n.prev?n.prev.next=n:e=n,function(){!s||e===null||(s=!1,n.next?n.next.prev=n.prev:t=n.prev,n.prev?n.prev.next=n.next:e=n.next)}}}}var T={notify(){},get:()=>[]};function le(e,t){let i,s=T,n=0,r=!1;function a(x){v();const G=s.subscribe(x);let P=!1;return()=>{P||(P=!0,G(),f())}}function c(){s.notify()}function o(){p.onStateChange&&p.onStateChange()}function m(){return r}function v(){n++,i||(i=e.subscribe(o),s=ce())}function f(){n--,i&&n===0&&(i(),i=void 0,s.clear(),s=T)}function S(){r||(r=!0,v())}function u(){r&&(r=!1,f())}const p={addNestedSub:a,notifyNestedSubs:c,handleChangeWrapper:o,isSubscribed:m,trySubscribe:S,tryUnsubscribe:u,getListeners:()=>s};return p}var de=()=>typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",ue=de(),fe=()=>typeof navigator<"u"&&navigator.product==="ReactNative",pe=fe(),he=()=>ue||pe?d.useLayoutEffect:d.useEffect,ve=he(),y=Symbol.for("react-redux-context"),w=typeof globalThis<"u"?globalThis:{};function ge(){if(!d.createContext)return{};const e=w[y]??(w[y]=new Map);let t=e.get(d.createContext);return t||(t=d.createContext(null),e.set(d.createContext,t)),t}var g=ge();function me(e){const{children:t,context:i,serverState:s,store:n}=e,r=d.useMemo(()=>{const o=le(n);return{store:n,subscription:o,getServerState:s?()=>s:void 0}},[n,s]),a=d.useMemo(()=>n.getState(),[n]);ve(()=>{const{subscription:o}=r;return o.onStateChange=o.notifyNestedSubs,o.trySubscribe(),a!==n.getState()&&o.notifyNestedSubs(),()=>{o.tryUnsubscribe(),o.onStateChange=void 0}},[r,a]);const c=i||g;return d.createElement(c.Provider,{value:r},t)}var tt=me;function C(e=g){return function(){return d.useContext(e)}}var W=C();function H(e=g){const t=e===g?W:C(e),i=()=>{const{store:s}=t();return s};return Object.assign(i,{withTypes:()=>i}),i}var j=H();function Se(e=g){const t=e===g?j:H(e),i=()=>t().dispatch;return Object.assign(i,{withTypes:()=>i}),i}var be=Se(),xe=(e,t)=>e===t;function ye(e=g){const t=e===g?W:C(e),i=(s,n={})=>{const{equalityFn:r=xe}=typeof n=="function"?{equalityFn:n}:n,a=t(),{store:c,subscription:o,getServerState:m}=a;d.useRef(!0);const v=d.useCallback({[s.name](S){return s(S)}}[s.name],[s]),f=ae.useSyncExternalStoreWithSelector(o.addNestedSub,c.getState,m||c.getState,v,r);return d.useDebugValue(f),f};return Object.assign(i,{withTypes:()=>i}),i}var we=ye();const Ce={size:{row:3,col:4},lots:Array.from({length:6},()=>({id:l(4)}))},z=h({name:"AreaTiles",initialState:Ce,reducers:{setState(e,{payload:t}){Object.assign(e,t)},placeLot(e,{payload:{lotId:t,position:i}}){const s=e.lots.find(n=>n.id===t);s&&(s.position=i)}}}),it=z.actions,Ee={cards:[],blockFlipping:!1,blockActivating:!1},U=h({name:"CardSelect",initialState:Ee,reducers:{setState(e,{payload:t}){Object.assign(e,t)}}}),ke={cards:[],validMatchers:[],invalidMatchers:[],completedMatchers:[]},_=h({name:"memoCards",initialState:ke,reducers:{setState(e,{payload:t}){Object.assign(e,t)},serve(e,{payload:t}){(Array.isArray(t)?e.cards.filter(s=>t.includes(s.id)):e.cards.filter(s=>s.status==="decked").slice(-t.count)).forEach(s=>{s.status="served"})},highlight(e,{payload:t}){e.cards.filter(i=>t.includes(i.id)).forEach(i=>{i.highlighted=!i.highlighted})},elevate(e,{payload:t}){e.cards.filter(i=>t.includes(i.id)).forEach(i=>{i.elevated=!0})},shake(e,{payload:t}){e.cards.filter(i=>t.includes(i.id)).forEach(i=>{i.shaking=!i.shaking})},blockLowering(e,{payload:t}){e.blockLowering||(e.blockLowering=[]),e.blockLowering.push(...t)},lower(e,{payload:t}){e.cards.filter(i=>t.includes(i.id)).forEach(i=>{i.elevated=!1})},select(e,{payload:t}){(t?e.cards.filter(s=>t.includes(s.id)):e.cards.filter(s=>s.elevated)).forEach(s=>{s.status="selected"})},deselect(e,{payload:t}){if(Array.isArray(t)){e.cards.filter(a=>t.includes(a.id)).forEach(a=>{a.status="served",a.elevated=!1,delete a.correct});return}const i=t==null?void 0:t.ids,s=(t==null?void 0:t.keepCorrect)||[];(i?e.cards.filter(r=>i.includes(r.id)):e.cards.filter(r=>r.status==="selected")).forEach(r=>{r.status="served",r.elevated=!1,s.includes(r.id)||delete r.correct})},validate(e,{payload:t}){t.forEach(({id:i,correct:s})=>{const n=e.cards.find(r=>r.id===i);n&&(n.correct=s)}),delete e.validate},discard(e,{payload:t}){let i=e.cards;t==="selected"?i=i.filter(s=>s.status==="selected"):Array.isArray(t)?i=i.filter(s=>t.includes(s.id)):i=i.filter(s=>["served","selected"].includes(s.status)),i.forEach(s=>{s.status="discarded",delete s.elevated,delete s.highlighted,delete s.correct})}}}),Me={text:[],coins:[]},K=h({name:"memoCardsExplanation",initialState:Me,reducers:{setState(e,{payload:t}){Object.assign(e,t)}}}),Ae={text:`
    <div>Показания подозреваемого: "У меня алиби! Я вышел из музея раньше момента совершения преступления, ведь мне надо было <highlighted><operand id="total4">4</operand> часа</highlighted> добираться домой: сначала <highlighted><operand id="foot2h">2</operand> часа я шёл пешком</highlighted> и проходил по <highlighted><operand id="foot5kmh">5</operand> километров</highlighted> каждый час, потом <highlighted><operand id="scooter2h">2</operand> часа ехал на электросамокате</highlighted> - по <highlighted><operand id="scooter25kmh">25</operand> километров каждый час</highlighted>."</div>
    <div><strong>Сколько километров проехал подозреваемый, если его рассказ - правда?</strong></div>
  `,solution:{steps:[{label:"Шаг 1",expression:[{type:"slot",item:{variant:"operand",id:l(4),accepts:["drop"]}},{type:"slot",item:{variant:"sign",id:l(4),accepts:["drop"]}},{type:"slot",item:{variant:"operand",id:l(4),accepts:["drop"]}},{type:"sign",item:{variant:"equals"}},{type:"slot",item:{variant:"operand",id:l(4),accepts:["input"]}}]},{label:"Шаг 2",expression:[{type:"slot",item:{variant:"operand",id:l(4),accepts:["drop"]}},{type:"slot",item:{variant:"sign",id:l(4),accepts:["drop"]}},{type:"slot",item:{variant:"operand",id:l(4),accepts:["drop"]}},{type:"sign",item:{variant:"equals"}},{type:"slot",item:{variant:"operand",id:l(4),accepts:["input"]}}]},{label:"Шаг 3",expression:[{type:"slot",item:{variant:"operand",id:l(4),accepts:["drop"]}},{type:"slot",item:{variant:"sign",id:l(4),accepts:["drop"]}},{type:"slot",item:{variant:"operand",id:l(4),accepts:["drop"]}},{type:"sign",item:{variant:"equals"}},{type:"slot",item:{variant:"operand",id:l(4),accepts:["input"]}}]}],answer:{label:"Ответ",expression:[{type:"slot",item:{variant:"operand",id:l(4),accepts:["input"]}}]},activeStepIndex:0}},E=h({name:"TextProblem",initialState:Ae,reducers:{setState(e,{payload:t}){Object.assign(e,t)},placeToken(e,{payload:t}){const{slotId:i,token:s}=t,n=[...e.solution.steps,e.solution.answer].map(r=>r.expression).flat().find(r=>r.type==="slot"&&r.item.id===i);(n==null?void 0:n.type)==="slot"&&(n.item.token=s)},setStep(e,{payload:t}){e.solution.activeStepIndex=t},redoStep(e,{payload:t}){[...e.solution.steps.slice(t),e.solution.answer].forEach(s=>s.expression.forEach(n=>n.type==="slot"&&delete n.item.token))}}}),st=E.actions,Oe={},k=h({name:"action",initialState:Oe,reducers:{setAction(e,{payload:t}){const{variant:i,prop:s,text:n,next:r,options:a}=t;e.variant=i,e.prop=s,e.text=n,e.next=r,e.options=a},resetAction(e){delete e.variant,delete e.prop,delete e.text,delete e.next,delete e.options}}}),{setAction:nt,resetAction:rt}=k.actions,Ie={messages:[]},M=h({name:"chat",initialState:Ie,reducers:{pushMessage(e,{payload:t}){e.messages.unshift(t)},pinMessage(e,{payload:t}){const i=e.messages.find(s=>s.id===t);i&&(i.pinned=!0)},unpinMessage(e){const t=e.messages.find(i=>i.pinned);t&&(t.pinned=!1)}}}),{pushMessage:at,pinMessage:ot,unpinMessage:ct}=M.actions,Pe={},A=h({name:"interactive",initialState:Pe,reducers:{attachInteractive(e,{payload:t}){e.component=t.component,e.triggers=t.triggers},detachInteractive(e){delete e.component,delete e.triggers},setTriggers(e,{payload:t}){e.triggers=Object.assign(e.triggers||{},t)}}}),{attachInteractive:lt,detachInteractive:dt,setTriggers:ut}=A.actions,$e={sections:[],activeSection:0},O=h({name:"progress",initialState:$e,reducers:{initProgress(e,{payload:t}){e.sections=t.sections,e.activeSection=t.activeSection},setActiveSection(e,{payload:t}){e.activeSection=t},setProgress:(e,{payload:t})=>{const i=e.sections[e.activeSection];i.rate=t/i.total*100},completeSection:e=>{e.sections[e.activeSection].completed=!0}}}),{initProgress:ft,setActiveSection:pt,setProgress:ht,completeSection:vt}=O.actions;function q(e,t,i){t=="__proto__"&&$?$(e,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[t]=i}var Te=Object.prototype,Re=Te.hasOwnProperty;function B(e,t,i){var s=e[t];(!(Re.call(e,t)&&J(s,i))||i===void 0&&!(t in e))&&q(e,t,i)}function Le(e,t,i,s){var n=!i;i||(i={});for(var r=-1,a=t.length;++r<a;){var c=t[r],o=void 0;o===void 0&&(o=e[c]),n?q(i,c,o):B(i,c,o)}return i}function De(e){return Q(function(t,i){var s=-1,n=i.length,r=n>1?i[n-1]:void 0,a=n>2?i[2]:void 0;for(r=e.length>3&&typeof r=="function"?(n--,r):void 0,a&&X(i[0],i[1],a)&&(r=n<3?void 0:r,n=1),t=Object(t);++s<n;){var c=i[s];c&&e(t,c,s,r)}return t})}function Ne(e,t){return function(i){return e(t(i))}}var Ve=Ne(Object.keys,Object),We=Object.prototype,He=We.hasOwnProperty;function je(e){if(!L(e))return Ve(e);var t=[];for(var i in Object(e))He.call(e,i)&&i!="constructor"&&t.push(i);return t}function ze(e){return D(e)?Y(e):je(e)}var Ue=Object.prototype,_e=Ue.hasOwnProperty,Ke=De(function(e,t){if(L(t)||D(t)){Le(t,ze(t),e);return}for(var i in t)_e.call(t,i)&&B(e,i,t[i])});const qe={events:[],context:{},watchers:{},styles:{},idles:{},confetti:!1,meme:"",smartik:"proud",comics:null,sideSlide:null},I=h({name:"tutor",initialState:qe,reducers:{pushEvent(e,{payload:t}){e.events.push(t)},extendContext(e,{payload:t}){e.context={...e.context,...t}},addWatcher(e,{payload:t}){const{name:i,matchers:s}=t;e.watchers[i]=s},removeWatcher(e,{payload:t}){delete e.watchers[t]},showMeme(e,{payload:t}){e.meme=t},hideMeme(e){e.meme=""},setStyles(e,{payload:t}){Ke(e.styles,t)},addIdle(e,{payload:t}){const{name:i,next:s,delay:n}=t;e.idles[i]={next:s,delay:n}},showConfetti(e){e.confetti=!0},hideConfetti(e){e.confetti=!1},removeIdle(e,{payload:t}){delete e.idles[t]},offerHelp(e,{payload:t}){e.help=t},resetHelp(e){delete e.help},smartikState(e,{payload:t}){e.smartik=t},showComics(e,{payload:t}){e.comics={slides:(t==null?void 0:t.slides)||[],id:t==null?void 0:t.id}},hideComics(e){e.comics=null},showSticker(e,{payload:t}){e.sticker=t},hideSticker(e){delete e.sticker},showSideSlide(e,{payload:t}){e.sideSlide=t},hideSideSlide(e){e.sideSlide=null}}}),gt=(e,t)=>i=>{i(Ge(e)),setTimeout(()=>{i(Je())},t)},mt=e=>t=>{t(Be()),setTimeout(()=>{t(Fe())},e)},St=(e,t)=>i=>{i(Qe(t)),setTimeout(()=>{i(Xe())},e)},{pushEvent:bt,extendContext:xt,addWatcher:yt,removeWatcher:wt,setStyles:Ct,addIdle:Et,removeIdle:kt,offerHelp:Mt,resetHelp:At,showConfetti:Be,hideConfetti:Fe,showMeme:Ge,hideMeme:Je,smartikState:Ot,showComics:It,hideComics:Pt,showSticker:Qe,hideSticker:Xe,showSideSlide:$t,hideSideSlide:Tt}=I.actions,Rt={CardSelect:U,MemoCards:_,MemoCardsExplanation:K,TextProblem:E},F={action:k.reducer,chat:M.reducer,interactive:A.reducer,progress:O.reducer,tutor:I.reducer,CardSelect:U.reducer,MemoCards:_.reducer,MemoCardsExplanation:K.reducer,TextProblem:E.reducer,AreaTiles:z.reducer};R({reducer:F});const Lt=be.withTypes(),Dt=we.withTypes();j.withTypes();const Nt=(e={})=>R({reducer:F,preloadedState:{action:k.getInitialState(),chat:M.getInitialState(),interactive:A.getInitialState(),progress:O.getInitialState(),tutor:I.getInitialState(),...e}});export{mt as A,Ot as B,ot as C,ct as D,Mt as E,At as F,It as G,St as H,$t as I,Tt as J,Rt as K,bt as L,_ as M,ht as N,Pt as O,tt as P,Ke as Q,Dt as a,it as b,st as c,B as d,Le as e,q as f,je as g,De as h,at as i,xt as j,ze as k,ft as l,nt as m,lt as n,Ne as o,Nt as p,dt as q,rt as r,Ct as s,ut as t,Lt as u,yt as v,gt as w,wt as x,Et as y,kt as z};

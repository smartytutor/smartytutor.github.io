import{n as l,c as v,a as R}from"./redux-toolkit.modern-DEr0YuQG.js";import{r as d}from"./index-DRjF_FHU.js";import{m as T,e as G,b as J,i as Q,f as D,g as L,h as X}from"./_arrayLikeKeys-BOaknIRz.js";var N={exports:{}},V={};/**
 * @license React
 * use-sync-external-store-with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var b=d;function Y(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Z=typeof Object.is=="function"?Object.is:Y,ee=b.useSyncExternalStore,te=b.useRef,ie=b.useEffect,se=b.useMemo,ne=b.useDebugValue;V.useSyncExternalStoreWithSelector=function(e,t,i,s,n){var r=te(null);if(r.current===null){var o={hasValue:!1,value:null};r.current=o}else o=r.current;r=se(function(){function a(u){if(!m){if(m=!0,h=u,u=s(u),n!==void 0&&o.hasValue){var p=o.value;if(n(p,u))return f=p}return f=u}if(p=f,Z(h,u))return p;var x=s(u);return n!==void 0&&n(p,x)?(h=u,p):(h=u,f=x)}var m=!1,h,f,S=i===void 0?null:i;return[function(){return a(t())},S===null?void 0:function(){return a(S())}]},[t,i,s,n]);var c=ee(e,r[0],r[1]);return ie(function(){o.hasValue=!0,o.value=c},[c]),ne(c),c};N.exports=V;var re=N.exports;function ae(e){e()}function oe(){let e=null,t=null;return{clear(){e=null,t=null},notify(){ae(()=>{let i=e;for(;i;)i.callback(),i=i.next})},get(){const i=[];let s=e;for(;s;)i.push(s),s=s.next;return i},subscribe(i){let s=!0;const n=t={callback:i,next:null,prev:t};return n.prev?n.prev.next=n:e=n,function(){!s||e===null||(s=!1,n.next?n.next.prev=n.prev:t=n.prev,n.prev?n.prev.next=n.next:e=n.next)}}}}var $={notify(){},get:()=>[]};function ce(e,t){let i,s=$,n=0,r=!1;function o(x){h();const F=s.subscribe(x);let P=!1;return()=>{P||(P=!0,F(),f())}}function c(){s.notify()}function a(){p.onStateChange&&p.onStateChange()}function m(){return r}function h(){n++,i||(i=e.subscribe(a),s=oe())}function f(){n--,i&&n===0&&(i(),i=void 0,s.clear(),s=$)}function S(){r||(r=!0,h())}function u(){r&&(r=!1,f())}const p={addNestedSub:o,notifyNestedSubs:c,handleChangeWrapper:a,isSubscribed:m,trySubscribe:S,tryUnsubscribe:u,getListeners:()=>s};return p}var le=()=>typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",de=le(),ue=()=>typeof navigator<"u"&&navigator.product==="ReactNative",fe=ue(),pe=()=>de||fe?d.useLayoutEffect:d.useEffect,he=pe(),y=Symbol.for("react-redux-context"),w=typeof globalThis<"u"?globalThis:{};function ve(){if(!d.createContext)return{};const e=w[y]??(w[y]=new Map);let t=e.get(d.createContext);return t||(t=d.createContext(null),e.set(d.createContext,t)),t}var g=ve();function ge(e){const{children:t,context:i,serverState:s,store:n}=e,r=d.useMemo(()=>{const a=ce(n);return{store:n,subscription:a,getServerState:s?()=>s:void 0}},[n,s]),o=d.useMemo(()=>n.getState(),[n]);he(()=>{const{subscription:a}=r;return a.onStateChange=a.notifyNestedSubs,a.trySubscribe(),o!==n.getState()&&a.notifyNestedSubs(),()=>{a.tryUnsubscribe(),a.onStateChange=void 0}},[r,o]);const c=i||g;return d.createElement(c.Provider,{value:r},t)}var Ze=ge;function C(e=g){return function(){return d.useContext(e)}}var W=C();function H(e=g){const t=e===g?W:C(e),i=()=>{const{store:s}=t();return s};return Object.assign(i,{withTypes:()=>i}),i}var z=H();function me(e=g){const t=e===g?z:H(e),i=()=>t().dispatch;return Object.assign(i,{withTypes:()=>i}),i}var Se=me(),be=(e,t)=>e===t;function xe(e=g){const t=e===g?W:C(e),i=(s,n={})=>{const{equalityFn:r=be}=typeof n=="function"?{equalityFn:n}:n,o=t(),{store:c,subscription:a,getServerState:m}=o;d.useRef(!0);const h=d.useCallback({[s.name](S){return s(S)}}[s.name],[s]),f=re.useSyncExternalStoreWithSelector(a.addNestedSub,c.getState,m||c.getState,h,r);return d.useDebugValue(f),f};return Object.assign(i,{withTypes:()=>i}),i}var ye=xe();const we={size:{row:3,col:4},lots:Array.from({length:6},()=>({id:l(4)}))},j=v({name:"AreaTiles",initialState:we,reducers:{setState(e,{payload:t}){Object.assign(e,t)},placeLot(e,{payload:{lotId:t,position:i}}){const s=e.lots.find(n=>n.id===t);s&&(s.position=i)}}}),et=j.actions,Ce={cards:[],blockFlipping:!1,blockActivating:!1},U=v({name:"CardSelect",initialState:Ce,reducers:{setState(e,{payload:t}){Object.assign(e,t)}}}),Ee={cards:[],validMatchers:[],invalidMatchers:[],completedMatchers:[]},_=v({name:"memoCards",initialState:Ee,reducers:{setState(e,{payload:t}){Object.assign(e,t)},serve(e,{payload:t}){(Array.isArray(t)?e.cards.filter(s=>t.includes(s.id)):e.cards.filter(s=>s.status==="decked").slice(-t.count)).forEach(s=>{s.status="served"})},highlight(e,{payload:t}){e.cards.filter(i=>t.includes(i.id)).forEach(i=>{i.highlighted=!i.highlighted})},elevate(e,{payload:t}){e.cards.filter(i=>t.includes(i.id)).forEach(i=>{i.elevated=!0})},shake(e,{payload:t}){e.cards.filter(i=>t.includes(i.id)).forEach(i=>{i.shaking=!i.shaking})},lower(e,{payload:t}){e.cards.filter(i=>t.includes(i.id)).forEach(i=>{i.elevated=!1})},select(e,{payload:t}){(t?e.cards.filter(s=>t.includes(s.id)):e.cards.filter(s=>s.elevated)).forEach(s=>{s.status="selected"})},deselect(e,{payload:t}){(t?e.cards.filter(s=>t.includes(s.id)):e.cards.filter(s=>s.status==="selected")).forEach(s=>{s.status="served",s.elevated=!1,delete s.correct})},validate(e,{payload:t}){t.forEach(({id:i,correct:s})=>{const n=e.cards.find(r=>r.id===i);n&&(n.correct=s)}),delete e.validate},discard(e,{payload:t}){let i=e.cards;t==="selected"?i=i.filter(s=>s.status==="selected"):Array.isArray(t)?i=i.filter(s=>t.includes(s.id)):i=i.filter(s=>["served","selected"].includes(s.status)),i.forEach(s=>{s.status="discarded",delete s.elevated,delete s.highlighted,delete s.correct})}}}),Me={text:`
    <div>Показания подозреваемого: "У меня алиби! Я вышел из музея раньше момента совершения преступления, ведь мне надо было <highlighted><operand id="total4">4</operand> часа</highlighted> добираться домой: сначала <highlighted><operand id="foot2h">2</operand> часа я шёл пешком</highlighted> и проходил по <highlighted><operand id="foot5kmh">5</operand> километров</highlighted> каждый час, потом <highlighted><operand id="scooter2h">2</operand> часа ехал на электросамокате</highlighted> - по <highlighted><operand id="scooter25kmh">25</operand> километров каждый час</highlighted>."</div>
    <div><strong>Сколько километров проехал подозреваемый, если его рассказ - правда?</strong></div>
  `,solution:{steps:[{label:"Шаг 1",expression:[{type:"slot",item:{variant:"operand",id:l(4),accepts:["drop"]}},{type:"slot",item:{variant:"sign",id:l(4),accepts:["drop"]}},{type:"slot",item:{variant:"operand",id:l(4),accepts:["drop"]}},{type:"sign",item:{variant:"equals"}},{type:"slot",item:{variant:"operand",id:l(4),accepts:["input"]}}]},{label:"Шаг 2",expression:[{type:"slot",item:{variant:"operand",id:l(4),accepts:["drop"]}},{type:"slot",item:{variant:"sign",id:l(4),accepts:["drop"]}},{type:"slot",item:{variant:"operand",id:l(4),accepts:["drop"]}},{type:"sign",item:{variant:"equals"}},{type:"slot",item:{variant:"operand",id:l(4),accepts:["input"]}}]},{label:"Шаг 3",expression:[{type:"slot",item:{variant:"operand",id:l(4),accepts:["drop"]}},{type:"slot",item:{variant:"sign",id:l(4),accepts:["drop"]}},{type:"slot",item:{variant:"operand",id:l(4),accepts:["drop"]}},{type:"sign",item:{variant:"equals"}},{type:"slot",item:{variant:"operand",id:l(4),accepts:["input"]}}]}],answer:{label:"Ответ",expression:[{type:"slot",item:{variant:"operand",id:l(4),accepts:["input"]}}]},activeStepIndex:0}},E=v({name:"TextProblem",initialState:Me,reducers:{setState(e,{payload:t}){Object.assign(e,t)},placeToken(e,{payload:t}){const{slotId:i,token:s}=t,n=[...e.solution.steps,e.solution.answer].map(r=>r.expression).flat().find(r=>r.type==="slot"&&r.item.id===i);(n==null?void 0:n.type)==="slot"&&(n.item.token=s)},setStep(e,{payload:t}){e.solution.activeStepIndex=t},redoStep(e,{payload:t}){[...e.solution.steps.slice(t),e.solution.answer].forEach(s=>s.expression.forEach(n=>n.type==="slot"&&delete n.item.token))}}}),tt=E.actions,ke={},M=v({name:"action",initialState:ke,reducers:{setAction(e,{payload:t}){const{variant:i,prop:s,text:n,next:r,options:o}=t;e.variant=i,e.prop=s,e.text=n,e.next=r,e.options=o},resetAction(e){delete e.variant,delete e.prop,delete e.text,delete e.next,delete e.options}}}),{setAction:it,resetAction:st}=M.actions,Oe={messages:[]},k=v({name:"chat",initialState:Oe,reducers:{pushMessage(e,{payload:t}){e.messages.unshift(t)},pinMessage(e,{payload:t}){const i=e.messages.find(s=>s.id===t);i&&(i.pinned=!0)},unpinMessage(e){const t=e.messages.find(i=>i.pinned);t&&(t.pinned=!1)}}}),{pushMessage:nt,pinMessage:rt,unpinMessage:at}=k.actions,Ae={},O=v({name:"interactive",initialState:Ae,reducers:{attachInteractive(e,{payload:t}){e.component=t.component,e.triggers=t.triggers},detachInteractive(e){delete e.component,delete e.triggers},setTriggers(e,{payload:t}){e.triggers=Object.assign(e.triggers||{},t)}}}),{attachInteractive:ot,detachInteractive:ct,setTriggers:lt}=O.actions,Ie={sections:[],activeSection:0},A=v({name:"progress",initialState:Ie,reducers:{initProgress(e,{payload:t}){e.sections=t.sections,e.activeSection=t.activeSection},setActiveSection(e,{payload:t}){e.activeSection=t},setProgress:(e,{payload:t})=>{const i=e.sections[e.activeSection];i.rate=t/i.total*100},completeSection:e=>{e.sections[e.activeSection].completed=!0}}}),{initProgress:dt,setActiveSection:ut,setProgress:ft,completeSection:pt}=A.actions;function K(e,t,i){t=="__proto__"&&T?T(e,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[t]=i}var Pe=Object.prototype,Te=Pe.hasOwnProperty;function q(e,t,i){var s=e[t];(!(Te.call(e,t)&&G(s,i))||i===void 0&&!(t in e))&&K(e,t,i)}function $e(e,t,i,s){var n=!i;i||(i={});for(var r=-1,o=t.length;++r<o;){var c=t[r],a=void 0;a===void 0&&(a=e[c]),n?K(i,c,a):q(i,c,a)}return i}function Re(e){return J(function(t,i){var s=-1,n=i.length,r=n>1?i[n-1]:void 0,o=n>2?i[2]:void 0;for(r=e.length>3&&typeof r=="function"?(n--,r):void 0,o&&Q(i[0],i[1],o)&&(r=n<3?void 0:r,n=1),t=Object(t);++s<n;){var c=i[s];c&&e(t,c,s,r)}return t})}function De(e,t){return function(i){return e(t(i))}}var Le=De(Object.keys,Object),Ne=Object.prototype,Ve=Ne.hasOwnProperty;function We(e){if(!D(e))return Le(e);var t=[];for(var i in Object(e))Ve.call(e,i)&&i!="constructor"&&t.push(i);return t}function He(e){return L(e)?X(e):We(e)}var ze=Object.prototype,je=ze.hasOwnProperty,Ue=Re(function(e,t){if(D(t)||L(t)){$e(t,He(t),e);return}for(var i in t)je.call(t,i)&&q(e,i,t[i])});const _e={events:[],context:{},watchers:{},styles:{},idles:{},confetti:!1,meme:"",smartik:"proud",comics:null,sideSlide:null},I=v({name:"tutor",initialState:_e,reducers:{pushEvent(e,{payload:t}){e.events.push(t)},extendContext(e,{payload:t}){e.context={...e.context,...t}},addWatcher(e,{payload:t}){const{name:i,matchers:s}=t;e.watchers[i]=s},removeWatcher(e,{payload:t}){delete e.watchers[t]},showMeme(e,{payload:t}){e.meme=t},hideMeme(e){e.meme=""},setStyles(e,{payload:t}){Ue(e.styles,t)},addIdle(e,{payload:t}){const{name:i,next:s,delay:n}=t;e.idles[i]={next:s,delay:n}},showConfetti(e){e.confetti=!0},hideConfetti(e){e.confetti=!1},removeIdle(e,{payload:t}){delete e.idles[t]},offerHelp(e,{payload:t}){e.help=t},resetHelp(e){delete e.help},smartikState(e,{payload:t}){e.smartik=t},showComics(e,{payload:t}){e.comics={slides:(t==null?void 0:t.slides)||[],id:t==null?void 0:t.id}},hideComics(e){e.comics=null},showSticker(e,{payload:t}){e.sticker=t},hideSticker(e){delete e.sticker},showSideSlide(e,{payload:t}){e.sideSlide=t},hideSideSlide(e){e.sideSlide=null}}}),ht=(e,t)=>i=>{i(Be(e)),setTimeout(()=>{i(Fe())},t)},vt=e=>t=>{t(Ke()),setTimeout(()=>{t(qe())},e)},gt=(e,t)=>i=>{i(Ge(t)),setTimeout(()=>{i(Je())},e)},{pushEvent:mt,extendContext:St,addWatcher:bt,removeWatcher:xt,setStyles:yt,addIdle:wt,removeIdle:Ct,offerHelp:Et,resetHelp:Mt,showConfetti:Ke,hideConfetti:qe,showMeme:Be,hideMeme:Fe,smartikState:kt,showComics:Ot,hideComics:At,showSticker:Ge,hideSticker:Je,showSideSlide:It,hideSideSlide:Pt}=I.actions,Tt={CardSelect:U,MemoCards:_,TextProblem:E},B={action:M.reducer,chat:k.reducer,interactive:O.reducer,progress:A.reducer,tutor:I.reducer,CardSelect:U.reducer,MemoCards:_.reducer,TextProblem:E.reducer,AreaTiles:j.reducer};R({reducer:B});const $t=Se.withTypes(),Rt=ye.withTypes();z.withTypes();const Dt=(e={})=>R({reducer:B,preloadedState:{action:M.getInitialState(),chat:k.getInitialState(),interactive:O.getInitialState(),progress:A.getInitialState(),tutor:I.getInitialState(),...e}});export{vt as A,kt as B,rt as C,at as D,Et as E,Ot as F,gt as G,It as H,Pt as I,Tt as J,mt as K,_ as L,ft as M,At as N,Mt as O,Ze as P,Ue as Q,Rt as a,et as b,tt as c,q as d,$e as e,K as f,We as g,Re as h,nt as i,St as j,He as k,dt as l,it as m,ot as n,De as o,Dt as p,ct as q,st as r,yt as s,lt as t,$t as u,bt as v,ht as w,xt as x,wt as y,Ct as z};

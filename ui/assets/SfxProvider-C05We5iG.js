import{j as w}from"./jsx-runtime-DiklIkkE.js";import{r as i}from"./index-DRjF_FHU.js";const R=i.createContext(null);function v(s,t,c,m){return new Promise(l=>{if(m<=0){s.volume=u(c),l();return}const d=performance.now(),o=n=>{const e=Math.min(1,(n-d)/m);s.volume=u(t+(c-t)*e),e<1&&!s.paused?requestAnimationFrame(o):(s.volume=u(c),l())};requestAnimationFrame(o)})}const u=s=>Math.max(0,Math.min(1,s)),g=({children:s})=>{const t=i.useRef(new Map),c=i.useRef(new Set),m=i.useCallback(async({src:o,volume:n=1,loop:e=!1,fadeInMs:p=0,channel:a})=>{if(!o)return;if(a){const x=t.current.get(a);if(x){try{x.pause(),x.src=""}catch{}t.current.delete(a)}}const r=new Audio(o);r.loop=e,r.volume=u(p>0?0:n);const y=()=>{a?t.current.set(a,r):c.current.add(r)},f=()=>{a&&t.current.delete(a),c.current.delete(r)};r.addEventListener("ended",f,{once:!0}),r.addEventListener("error",f,{once:!0}),y();try{await r.play(),p>0&&await v(r,0,u(n),p)}catch{f()}},[]),l=i.useCallback(async({channel:o,fadeOutMs:n=0})=>{const e=t.current.get(o||"");if(e)try{const p=u(Number.isFinite(e.volume)?e.volume:1);n>0&&await v(e,p,0,n),e.pause(),e.src=""}finally{t.current.delete(o)}},[]),d=i.useMemo(()=>({play:m,stop:l}),[m,l]);return w.jsx(R.Provider,{value:d,children:s})};g.__docgenInfo={description:"",methods:[],displayName:"SfxProvider",props:{children:{required:!0,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""}}};export{R as S,g as a};

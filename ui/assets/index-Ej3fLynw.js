import{c as p,n as $,a as R}from"./redux-toolkit.modern-CeOX0_sF.js";import{r as l}from"./index-DRjF_FHU.js";import{m as L,h as J,b as Q,g as X,d as D,e as Y,f as N}from"./_arrayLikeKeys-BQo_jNKa.js";var V={exports:{}},W={};/**
 * @license React
 * use-sync-external-store-with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var S=l;function Z(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var ee=typeof Object.is=="function"?Object.is:Z,te=S.useSyncExternalStore,se=S.useRef,ie=S.useEffect,ne=S.useMemo,re=S.useDebugValue;W.useSyncExternalStoreWithSelector=function(e,t,s,i,n){var r=se(null);if(r.current===null){var o={hasValue:!1,value:null};r.current=o}else o=r.current;r=ne(function(){function a(d){if(!g){if(g=!0,h=d,d=i(d),n!==void 0&&o.hasValue){var f=o.value;if(n(f,d))return u=f}return u=d}if(f=u,ee(h,d))return f;var b=i(d);return n!==void 0&&n(f,b)?(h=d,f):(h=d,u=b)}var g=!1,h,u,m=s===void 0?null:s;return[function(){return a(t())},m===null?void 0:function(){return a(m())}]},[t,s,i,n]);var c=te(e,r[0],r[1]);return ie(function(){o.hasValue=!0,o.value=c},[c]),re(c),c};V.exports=W;var oe=V.exports;function ae(e){e()}function ce(){let e=null,t=null;return{clear(){e=null,t=null},notify(){ae(()=>{let s=e;for(;s;)s.callback(),s=s.next})},get(){const s=[];let i=e;for(;i;)s.push(i),i=i.next;return s},subscribe(s){let i=!0;const n=t={callback:s,next:null,prev:t};return n.prev?n.prev.next=n:e=n,function(){!i||e===null||(i=!1,n.next?n.next.prev=n.prev:t=n.prev,n.prev?n.prev.next=n.next:e=n.next)}}}}var T={notify(){},get:()=>[]};function le(e,t){let s,i=T,n=0,r=!1;function o(b){h();const G=i.subscribe(b);let P=!1;return()=>{P||(P=!0,G(),u())}}function c(){i.notify()}function a(){f.onStateChange&&f.onStateChange()}function g(){return r}function h(){n++,s||(s=e.subscribe(a),i=ce())}function u(){n--,s&&n===0&&(s(),s=void 0,i.clear(),i=T)}function m(){r||(r=!0,h())}function d(){r&&(r=!1,u())}const f={addNestedSub:o,notifyNestedSubs:c,handleChangeWrapper:a,isSubscribed:g,trySubscribe:m,tryUnsubscribe:d,getListeners:()=>i};return f}var de=()=>typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",ue=de(),fe=()=>typeof navigator<"u"&&navigator.product==="ReactNative",pe=fe(),he=()=>ue||pe?l.useLayoutEffect:l.useEffect,ve=he(),x=Symbol.for("react-redux-context"),y=typeof globalThis<"u"?globalThis:{};function ge(){if(!l.createContext)return{};const e=y[x]??(y[x]=new Map);let t=e.get(l.createContext);return t||(t=l.createContext(null),e.set(l.createContext,t)),t}var v=ge();function me(e){const{children:t,context:s,serverState:i,store:n}=e,r=l.useMemo(()=>{const a=le(n);return{store:n,subscription:a,getServerState:i?()=>i:void 0}},[n,i]),o=l.useMemo(()=>n.getState(),[n]);ve(()=>{const{subscription:a}=r;return a.onStateChange=a.notifyNestedSubs,a.trySubscribe(),o!==n.getState()&&a.notifyNestedSubs(),()=>{a.tryUnsubscribe(),a.onStateChange=void 0}},[r,o]);const c=s||v;return l.createElement(c.Provider,{value:r},t)}var tt=me;function w(e=v){return function(){return l.useContext(e)}}var H=w();function j(e=v){const t=e===v?H:w(e),s=()=>{const{store:i}=t();return i};return Object.assign(s,{withTypes:()=>s}),s}var z=j();function Se(e=v){const t=e===v?z:j(e),s=()=>t().dispatch;return Object.assign(s,{withTypes:()=>s}),s}var be=Se(),xe=(e,t)=>e===t;function ye(e=v){const t=e===v?H:w(e),s=(i,n={})=>{const{equalityFn:r=xe}=typeof n=="function"?{equalityFn:n}:n,o=t(),{store:c,subscription:a,getServerState:g}=o;l.useRef(!0);const h=l.useCallback({[i.name](m){return i(m)}}[i.name],[i]),u=oe.useSyncExternalStoreWithSelector(a.addNestedSub,c.getState,g||c.getState,h,r);return l.useDebugValue(u),u};return Object.assign(s,{withTypes:()=>s}),s}var we=ye();const Ce={size:{row:3,col:4},lots:Array.from({length:6},()=>({id:$(4)})),modules:[],mode:"demo",showModules:!1,showLots:!1,showModulesOnLots:!1,allowDragging:!1,allowClearing:!0,highlightedSlots:void 0,backgroundSrc:void 0,backgroundFocus:void 0},C=p({name:"AreaTiles",initialState:Ce,reducers:{setState(e,{payload:t}){Object.assign(e,t)},placeLot(e,{payload:{lotId:t,position:s}}){const i=e.lots.find(n=>n.id===t);i&&(i.position=s)},resetLots(e){e.lots.forEach(t=>{t.position=void 0})},discardLots(e,{payload:t}){if(e.discardedLots=[],t>0){const s=e.lots.filter(i=>!i.position).slice(-t);e.discardedLots=s,e.lots=e.lots.filter(i=>!s.includes(i))}},applyLayout(e,{payload:{layout:t}}){const s=e.lots.filter(n=>!n.position);let i=0;for(let n=0;n<t.length;n++)for(let r=0;r<t[n].length;r++)t[n][r]===1&&i<s.length&&(s[i].position={row:n,col:r},i++)},placeModule(e,{payload:{name:t,position:s,width:i,height:n}}){const r={id:$(4),name:t,position:s,width:i,height:n};e.modules.push(r)}}}),st=C.actions,ke={cards:[],blockFlipping:!1,blockActivating:!1,flippedCards:[],elevatedCard:null,finale:!1},U=p({name:"CardSelect",initialState:ke,reducers:{setState(e,{payload:t}){Object.assign(e,t)},addFlippedCard(e,{payload:t}){e.flippedCards.find(i=>i.id===t.id)||e.flippedCards.push(t)},elevate(e,{payload:t}){e.elevatedCard=t}}}),Ee={cards:[],validMatchers:[],invalidMatchers:[],completedMatchers:[],blockClicks:!0},_=p({name:"memoCards",initialState:Ee,reducers:{setState(e,{payload:t}){Object.assign(e,t)},serve(e,{payload:t}){(Array.isArray(t)?e.cards.filter(i=>t.includes(i.id)):e.cards.filter(i=>i.status==="decked").slice(-t.count)).forEach(i=>{i.status="served"})},highlight(e,{payload:t}){e.cards.filter(s=>t.includes(s.id)).forEach(s=>{s.highlighted=!s.highlighted})},elevate(e,{payload:t}){e.cards.filter(s=>t.includes(s.id)).forEach(s=>{s.elevated=!0})},shake(e,{payload:t}){e.cards.filter(s=>t.includes(s.id)).forEach(s=>{s.shaking=!s.shaking})},blockLowering(e,{payload:t}){e.blockLowering||(e.blockLowering=[]),e.blockLowering.push(...t)},lower(e,{payload:t}){e.cards.filter(s=>t.includes(s.id)).forEach(s=>{s.elevated=!1})},select(e,{payload:t}){(t?e.cards.filter(i=>t.includes(i.id)):e.cards.filter(i=>i.elevated)).forEach(i=>{i.status="selected"})},deselect(e,{payload:t}){if(Array.isArray(t)){e.cards.filter(o=>t.includes(o.id)).forEach(o=>{o.status="served",o.elevated=!1,delete o.correct});return}const s=t==null?void 0:t.ids,i=(t==null?void 0:t.keepCorrect)||[];(s?e.cards.filter(r=>s.includes(r.id)):e.cards.filter(r=>r.status==="selected")).forEach(r=>{r.status="served",r.elevated=!1,i.includes(r.id)||delete r.correct})},validate(e,{payload:t}){t.forEach(({id:s,correct:i})=>{const n=e.cards.find(r=>r.id===s);n&&(n.correct=i)}),delete e.validate},discard(e,{payload:t}){let s=e.cards;t==="selected"?s=s.filter(i=>i.status==="selected"):Array.isArray(t)?s=s.filter(i=>t.includes(i.id)):s=s.filter(i=>["served","selected"].includes(i.status)),s.forEach(i=>{i.status="discarded",delete i.elevated,delete i.highlighted,delete i.correct})}}}),Me={text:[],coins:[]},B=p({name:"memoCardsExplanation",initialState:Me,reducers:{setState(e,{payload:t}){Object.assign(e,t)}}}),Ie={text:`
    <div>Показания подозреваемого: "У меня алиби! Я вышел из музея раньше момента совершения преступления, ведь мне надо было <highlighted><operand id="total4">4</operand> часа</highlighted> добираться домой: сначала <highlighted><operand id="foot2h">2</operand> часа я шёл пешком</highlighted> и проходил по <highlighted><operand id="foot5kmh">5</operand> километров</highlighted> каждый час, потом <highlighted><operand id="scooter2h">2</operand> часа ехал на электросамокате</highlighted> - по <highlighted><operand id="scooter25kmh">25</operand> километров каждый час</highlighted>."</div>
    <div><strong>Сколько километров проехал подозреваемый, если его рассказ - правда?</strong></div>
  `,showSolution:!1,solution:{steps:[{label:"Шаг 1",expression:[{type:"slot",item:{variant:"operand",id:"step0slot0",accepts:["drop"]}},{type:"slot",item:{variant:"sign",id:"step0slot1",accepts:["drop"]}},{type:"slot",item:{variant:"operand",id:"step0slot2",accepts:["drop"]}},{type:"sign",item:{variant:"equals"}},{type:"slot",item:{variant:"operand",id:"step0slot3",accepts:[]}}]},{label:"Шаг 2",expression:[{type:"slot",item:{variant:"operand",id:"step1slot0",accepts:["drop"]}},{type:"slot",item:{variant:"sign",id:"step1slot1",accepts:["drop"]}},{type:"slot",item:{variant:"operand",id:"step1slot2",accepts:["drop"]}},{type:"sign",item:{variant:"equals"}},{type:"slot",item:{variant:"operand",id:"step1slot3",accepts:[]}}]},{label:"Шаг 3",expression:[{type:"slot",item:{variant:"operand",id:"step2slot0",accepts:["drop"]}},{type:"slot",item:{variant:"sign",id:"step2slot1",accepts:["drop"]}},{type:"slot",item:{variant:"operand",id:"step2slot2",accepts:["drop"]}},{type:"sign",item:{variant:"equals"}},{type:"slot",item:{variant:"operand",id:"step2slot3",accepts:[]}}]}],activeStepIndex:0}},k=p({name:"TextProblem",initialState:Ie,reducers:{setState(e,{payload:t}){Object.assign(e,t)},placeToken(e,{payload:t}){const{slotId:s,token:i}=t,n=e.solution.steps.map(r=>r.expression).flat().find(r=>r.type==="slot"&&r.item.id===s);(n==null?void 0:n.type)==="slot"&&(n.item.token=i)},dropToken(e,{payload:t}){const{stepIndex:s,tokenId:i}=t,n=e.solution.steps[s];n&&n.expression.forEach(r=>{var o;r.type==="slot"&&((o=r.item.token)==null?void 0:o.id)===i&&delete r.item.token})},setStep(e,{payload:t}){e.solution.activeStepIndex=t},redoStep(e,{payload:t}){e.solution.steps.slice(t).forEach(i=>i.expression.forEach(n=>{n.type==="slot"&&delete n.item.token}))},setSlotInput(e,{payload:t}){const{slotId:s,accepts:i,inputTokenId:n}=t,r=e.solution.steps.map(o=>o.expression).flat().find(o=>o.type==="slot"&&o.item.id===s);(r==null?void 0:r.type)==="slot"&&(r.item.accepts=i,n&&(r.item.inputTokenId=n))}}}),it=k.actions,Ae={},E=p({name:"action",initialState:Ae,reducers:{setAction(e,{payload:t}){const{variant:s,prop:i,text:n,next:r,options:o}=t;e.variant=s,e.prop=i,e.text=n,e.next=r,e.options=o},resetAction(e){delete e.variant,delete e.prop,delete e.text,delete e.next,delete e.options}}}),{setAction:nt,resetAction:rt}=E.actions,Oe={messages:[]},M=p({name:"chat",initialState:Oe,reducers:{pushMessage(e,{payload:t}){e.messages.unshift(t)},pinMessage(e,{payload:t}){const s=e.messages.find(i=>i.id===t);s&&(s.pinned=!0)},unpinMessage(e){const t=e.messages.find(s=>s.pinned);t&&(t.pinned=!1)}}}),{pushMessage:ot,pinMessage:at,unpinMessage:ct}=M.actions,Pe={},I=p({name:"interactive",initialState:Pe,reducers:{attachInteractive(e,{payload:t}){e.component=t.component,e.triggers=t.triggers},detachInteractive(e){delete e.component,delete e.triggers},setTriggers(e,{payload:t}){t&&Object.keys(t).length>0?e.triggers=Object.assign(e.triggers||{},t):e.triggers={}}}}),{attachInteractive:lt,detachInteractive:dt,setTriggers:ut}=I.actions,Le={sections:[],activeSection:0},A=p({name:"progress",initialState:Le,reducers:{initProgress(e,{payload:t}){e.sections=t.sections,e.activeSection=t.activeSection},setActiveSection(e,{payload:t}){e.activeSection=t},setActiveSectionByPrefix(e,{payload:t}){const s=e.sections.findIndex(i=>i.prefix===t);s>=0&&(e.activeSection=s)},setProgress:(e,{payload:t})=>{const s=e.sections[e.activeSection];s.rate=t/s.total*100},completeSection:e=>{const t=e.sections[e.activeSection];t&&(t.completed=!0,t.rate=100)}}}),{initProgress:ft,setActiveSection:pt,setActiveSectionByPrefix:ht,setProgress:vt,completeSection:gt}=A.actions;function F(e,t,s){t=="__proto__"&&L?L(e,t,{configurable:!0,enumerable:!0,value:s,writable:!0}):e[t]=s}var Te=Object.prototype,$e=Te.hasOwnProperty;function K(e,t,s){var i=e[t];(!($e.call(e,t)&&J(i,s))||s===void 0&&!(t in e))&&F(e,t,s)}function Re(e,t,s,i){var n=!s;s||(s={});for(var r=-1,o=t.length;++r<o;){var c=t[r],a=void 0;a===void 0&&(a=e[c]),n?F(s,c,a):K(s,c,a)}return s}function De(e){return Q(function(t,s){var i=-1,n=s.length,r=n>1?s[n-1]:void 0,o=n>2?s[2]:void 0;for(r=e.length>3&&typeof r=="function"?(n--,r):void 0,o&&X(s[0],s[1],o)&&(r=n<3?void 0:r,n=1),t=Object(t);++i<n;){var c=s[i];c&&e(t,c,i,r)}return t})}function Ne(e,t){return function(s){return e(t(s))}}var Ve=Ne(Object.keys,Object),We=Object.prototype,He=We.hasOwnProperty;function je(e){if(!D(e))return Ve(e);var t=[];for(var s in Object(e))He.call(e,s)&&s!="constructor"&&t.push(s);return t}function ze(e){return N(e)?Y(e):je(e)}var Ue=Object.prototype,_e=Ue.hasOwnProperty,Be=De(function(e,t){if(D(t)||N(t)){Re(t,ze(t),e);return}for(var s in t)_e.call(t,s)&&K(e,s,t[s])});const Fe={events:[],context:{},watchers:{},styles:{},idles:{},confetti:!1,meme:"",smartik:"proud",comics:null,sideSlide:null},O=p({name:"tutor",initialState:Fe,reducers:{pushEvent(e,{payload:t}){e.events.push(t)},extendContext(e,{payload:t}){e.context={...e.context,...t}},addWatcher(e,{payload:t}){const{name:s,matchers:i}=t;e.watchers[s]=i},removeWatcher(e,{payload:t}){delete e.watchers[t]},showMeme(e,{payload:t}){e.meme=t},hideMeme(e){e.meme=""},setStyles(e,{payload:t}){Be(e.styles,t)},addIdle(e,{payload:t}){const{name:s,next:i,delay:n}=t;e.idles[s]={next:i,delay:n}},showConfetti(e){e.confetti=!0},hideConfetti(e){e.confetti=!1},removeIdle(e,{payload:t}){delete e.idles[t]},offerHelp(e,{payload:t}){e.help=t},resetHelp(e){delete e.help},smartikState(e,{payload:t}){e.smartik=t},showComics(e,{payload:t}){e.comics={slides:(t==null?void 0:t.slides)||[],id:t==null?void 0:t.id}},hideComics(e){e.comics=null},showSticker(e,{payload:t}){e.sticker=t},hideSticker(e){delete e.sticker},showSideSlide(e,{payload:t}){e.sideSlide=t},hideSideSlide(e){e.sideSlide=null}}}),mt=(e,t)=>s=>{s(Ge(e)),setTimeout(()=>{s(Je())},t)},St=e=>t=>{t(Ke()),setTimeout(()=>{t(qe())},e)},bt=(e,t)=>s=>{s(Qe(t)),setTimeout(()=>{s(Xe())},e)},{pushEvent:xt,extendContext:yt,addWatcher:wt,removeWatcher:Ct,setStyles:kt,addIdle:Et,removeIdle:Mt,offerHelp:It,resetHelp:At,showConfetti:Ke,hideConfetti:qe,showMeme:Ge,hideMeme:Je,smartikState:Ot,showComics:Pt,hideComics:Lt,showSticker:Qe,hideSticker:Xe,showSideSlide:Tt,hideSideSlide:$t}=O.actions,Rt={CardSelect:U,MemoCards:_,MemoCardsExplanation:B,TextProblem:k,AreaTiles:C},q={action:E.reducer,chat:M.reducer,interactive:I.reducer,progress:A.reducer,tutor:O.reducer,CardSelect:U.reducer,MemoCards:_.reducer,MemoCardsExplanation:B.reducer,TextProblem:k.reducer,AreaTiles:C.reducer};R({reducer:q});const Dt=be.withTypes(),Nt=we.withTypes();z.withTypes();const Vt=(e={})=>R({reducer:q,preloadedState:{action:E.getInitialState(),chat:M.getInitialState(),interactive:I.getInitialState(),progress:A.getInitialState(),tutor:O.getInitialState(),...e}});export{Mt as A,St as B,Ot as C,at as D,ct as E,It as F,At as G,Pt as H,bt as I,Tt as J,$t as K,xt as L,st as M,_ as N,it as O,tt as P,vt as Q,Lt as R,Be as S,K as a,F as b,Re as c,je as d,De as e,Dt as f,ot as g,yt as h,ft as i,gt as j,ze as k,kt as l,nt as m,lt as n,Ne as o,Vt as p,Rt as q,rt as r,ht as s,dt as t,Nt as u,ut as v,wt as w,mt as x,Ct as y,Et as z};

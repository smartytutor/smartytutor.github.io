import{j as l}from"./jsx-runtime-DR9Q75dM.js";import{c as A}from"./clsx-B-dksMZM.js";import{A as L}from"./Answer-CpHO1qYv.js";import{r as f}from"./index-DRjF_FHU.js";import{a as D}from"./VoiceoverProvider-K0B6OSPK.js";import{M as _}from"./Message-ByLECGpj.js";import{m as h}from"./proxy-C00yw4cG.js";const N=()=>{const e=f.useContext(D);if(!e)throw new Error("useVoiceover must be used within a VoiceoverProvider");return e},y=({token:e,isRevealed:t,itemKey:n})=>{const r=e.trim()==="";return l.jsx("span",{className:t||r?"opacity-100":"opacity-25",style:{display:r?"inline":"inline-block",transition:"opacity 800ms ease-out"},children:e},n)};y.__docgenInfo={description:"Компонент для отображения одного анимированного токена (слова/пробела)",methods:[],displayName:"AnimatedToken",props:{token:{required:!0,tsType:{name:"string"},description:""},isRevealed:{required:!0,tsType:{name:"boolean"},description:""},itemKey:{required:!0,tsType:{name:"union",raw:"string | number",elements:[{name:"string"},{name:"number"}]},description:""}}};const I=({text:e,revealedWordIndices:t})=>{let n=0;return l.jsx(l.Fragment,{children:e.map((r,s)=>{const i=r.split(/(\s+)/),o=l.jsx("p",{children:i.map((a,u)=>{const c=n;return n++,l.jsx(y,{token:a,isRevealed:t.has(c),itemKey:`${s}-${u}`},`${s}-${u}`)})},s);return s<e.length-1&&n++,o})})};I.__docgenInfo={description:"Компонент для отображения многострочного анимированного текста",methods:[],displayName:"AnimatedMultilineText",props:{text:{required:!0,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:""},revealedWordIndices:{required:!0,tsType:{name:"Set",elements:[{name:"number"}],raw:"Set<number>"},description:""}}};const S=({tokens:e,revealedWordIndices:t})=>l.jsx("span",{children:e.map((n,r)=>l.jsx(y,{token:n,isRevealed:t.has(r),itemKey:r},r))});S.__docgenInfo={description:"Компонент для отображения однострочного анимированного текста",methods:[],displayName:"AnimatedSingleLineText",props:{tokens:{required:!0,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:""},revealedWordIndices:{required:!0,tsType:{name:"Set",elements:[{name:"number"}],raw:"Set<number>"},description:""}}};const E=({text:e})=>Array.isArray(e)?l.jsx(l.Fragment,{children:e.map((t,n)=>l.jsx("p",{children:t},n))}):l.jsx("span",{children:e});E.__docgenInfo={description:"Компонент для отображения статичного текста (без анимации)",methods:[],displayName:"StaticText",props:{text:{required:!0,tsType:{name:"union",raw:"string | string[]",elements:[{name:"string"},{name:"Array",elements:[{name:"string"}],raw:"string[]"}]},description:""}}};const d={DEFAULT_WORDS_PER_SECOND:2.5,AUDIO_TIME_USAGE_RATIO:.92,INITIAL_DELAY:0,SHORT_WORD_THRESHOLD:3,LONG_WORD_THRESHOLD:8,SHORT_WORD_MULTIPLIER:.88,LONG_WORD_MULTIPLIER:1.18,LINE_BREAK_PAUSE:100,TRANSITION_DURATION:800},g=e=>e.split(/\s+/).filter(t=>t.trim()!==""),j=(e,t,n)=>{let r=0;return e.map(i=>g(i).length).map(i=>{const o=i/t,a=n*o,u=r;return r+=a,{startTime:u*1e3,duration:a*1e3,wordsCount:i}})},T=e=>{const t=e.trim().length;return t<=d.SHORT_WORD_THRESHOLD?d.SHORT_WORD_MULTIPLIER:t>=d.LONG_WORD_THRESHOLD?d.LONG_WORD_MULTIPLIER:1},v=(e,t)=>{let n=0;for(let r=0;r<t.length;r++){const s=g(t[r]);if(n+s.length>e)return r;n+=s.length}return t.length-1},P=(e,t,n)=>{let r=0;for(let s=0;s<t;s++)r+=g(n[s]).length;return e-r},M=(e,t,n,r)=>{const{baseTimePerWord:s,lineTimings:i,useAdaptiveSpeed:o}=r;if(!o)return s*T(t);if(Array.isArray(n)&&i.length>0){const a=v(e,n),u=P(e,a,n),c=i[a];if(c){let p=1e3/(c.wordsCount/(c.duration/1e3));return p*=T(t),u===0&&a>0&&(p+=d.LINE_BREAK_PAUSE),p}}return s*T(t)},b=(e,t,n)=>f.useMemo(()=>{if(!t||t<=0)return{baseTimePerWord:1e3/d.DEFAULT_WORDS_PER_SECOND,lineTimings:[],useAdaptiveSpeed:!1};const r=n,s=t/1e3;if(Array.isArray(e)){const i=s*d.AUDIO_TIME_USAGE_RATIO,o=j(e,r,i);return{baseTimePerWord:1e3/d.DEFAULT_WORDS_PER_SECOND,lineTimings:o,useAdaptiveSpeed:!0}}else{const i=s*d.AUDIO_TIME_USAGE_RATIO;return{baseTimePerWord:1e3/Math.max(1,r/i),lineTimings:[],useAdaptiveSpeed:!0}}},[t,n,e]),U=(e,t,n,r,s,i,o,a)=>{f.useEffect(()=>{if(!e){a(new Set);return}if(t!==e||!n||r.length===0)return;let u=0,c;const m=()=>{if(u<r.length){const p=r[u];a(x=>new Set([...x,p]));const O=s[p],W=M(u,O,i,o);u++,c=setTimeout(m,W)}};return c=setTimeout(m,d.INITIAL_DELAY),()=>{c&&clearTimeout(c)}},[t,n,e,r,s,i,o,a])},k=(e,t)=>{const[n,r]=f.useState(new Set);return f.useEffect(()=>{r(new Set)},[e,t]),{revealedWordIndices:n,setRevealedWordIndices:r}},C=e=>{const t=f.useMemo(()=>Array.isArray(e)?e.join(" "):e,[e]),n=f.useMemo(()=>t.split(/(\s+)/),[t]),r=f.useMemo(()=>{const s=[];return n.forEach((i,o)=>{i.trim()!==""&&s.push(o)}),s},[n]);return{fullText:t,tokens:n,wordIndices:r}},R=({text:e,voiceover:t})=>{const{currentAudio:n,isPlaying:r,audioDuration:s}=N(),{revealedWordIndices:i,setRevealedWordIndices:o}=k(e,t),{tokens:a,wordIndices:u}=C(e),c=b(e,s,u.length);return U(t,n,r,u,a,e,c,o),t?Array.isArray(e)?l.jsx(I,{text:e,revealedWordIndices:i}):l.jsx(S,{tokens:a,revealedWordIndices:i}):l.jsx(E,{text:e})};R.__docgenInfo={description:"",methods:[],displayName:"KaraokeText",props:{text:{required:!0,tsType:{name:"union",raw:"string | string[]",elements:[{name:"string"},{name:"Array",elements:[{name:"string"}],raw:"string[]"}]},description:""},voiceover:{required:!1,tsType:{name:"string"},description:""}}};const q=({variant:e="default",messages:t,thinking:n=!1})=>l.jsxs("div",{className:"relative flex flex-col-reverse gap-y-3 pl-2 pr-4 xl:pr-6",children:[n&&l.jsx(h.div,{initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},layout:!0,children:l.jsx(_,{variant:"thinking"})}),t.map(({id:r,text:s,correct:i,answer:o,pinned:a,voiceover:u},c)=>l.jsx(h.div,{initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},layout:!0,transition:{delay:t.length>1&&c===0?.1:0,type:"spring",stiffness:300,damping:27.5},className:A(a&&"sticky top-1 z-50"),children:l.jsxs(_,{callout:e==="default"&&!o,variant:c===0?"default":"inactive",correct:i,pinned:a,className:A(e==="default"&&a&&"opacity-100",e==="default"&&!a&&c===1&&"opacity-80",e==="default"&&!a&&c===2&&"opacity-60",e==="default"&&!a&&c>2&&"opacity-40",o&&"translate-x-3 xl:translate-x-5"),children:[s&&l.jsx(R,{text:s,voiceover:u}),o==null?void 0:o.map((m,p)=>l.jsx(L,{variant:m.variant,children:Array.isArray(m.text)?m.text.join("<br>"):m.text},p))]})},r))]});q.__docgenInfo={description:"",methods:[],displayName:"Chat",props:{variant:{required:!1,tsType:{name:"union",raw:"'default' | 'history'",elements:[{name:"literal",value:"'default'"},{name:"literal",value:"'history'"}]},description:"",defaultValue:{value:"'default'",computed:!1}},messages:{required:!0,tsType:{name:"Array",elements:[{name:"Message"}],raw:"Message[]"},description:""},thinking:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}}}};export{q as C,R as K,N as u};

import{n as G,c as p,a as $}from"./redux-toolkit.modern-DEr0YuQG.js";import{r as l}from"./index-DRjF_FHU.js";import{m as P,h as J,b as Q,g as X,d as R,e as L,f as Y}from"./_arrayLikeKeys-CNLEhIRO.js";var D={exports:{}},N={};/**
 * @license React
 * use-sync-external-store-with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var S=l;function Z(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var ee=typeof Object.is=="function"?Object.is:Z,te=S.useSyncExternalStore,se=S.useRef,ie=S.useEffect,ne=S.useMemo,re=S.useDebugValue;N.useSyncExternalStoreWithSelector=function(e,t,s,i,n){var r=se(null);if(r.current===null){var o={hasValue:!1,value:null};r.current=o}else o=r.current;r=ne(function(){function a(d){if(!g){if(g=!0,h=d,d=i(d),n!==void 0&&o.hasValue){var f=o.value;if(n(f,d))return u=f}return u=d}if(f=u,ee(h,d))return f;var b=i(d);return n!==void 0&&n(f,b)?(h=d,f):(h=d,u=b)}var g=!1,h,u,m=s===void 0?null:s;return[function(){return a(t())},m===null?void 0:function(){return a(m())}]},[t,s,i,n]);var c=te(e,r[0],r[1]);return ie(function(){o.hasValue=!0,o.value=c},[c]),re(c),c};D.exports=N;var oe=D.exports;function ae(e){e()}function ce(){let e=null,t=null;return{clear(){e=null,t=null},notify(){ae(()=>{let s=e;for(;s;)s.callback(),s=s.next})},get(){const s=[];let i=e;for(;i;)s.push(i),i=i.next;return s},subscribe(s){let i=!0;const n=t={callback:s,next:null,prev:t};return n.prev?n.prev.next=n:e=n,function(){!i||e===null||(i=!1,n.next?n.next.prev=n.prev:t=n.prev,n.prev?n.prev.next=n.next:e=n.next)}}}}var T={notify(){},get:()=>[]};function le(e,t){let s,i=T,n=0,r=!1;function o(b){h();const B=i.subscribe(b);let O=!1;return()=>{O||(O=!0,B(),u())}}function c(){i.notify()}function a(){f.onStateChange&&f.onStateChange()}function g(){return r}function h(){n++,s||(s=e.subscribe(a),i=ce())}function u(){n--,s&&n===0&&(s(),s=void 0,i.clear(),i=T)}function m(){r||(r=!0,h())}function d(){r&&(r=!1,u())}const f={addNestedSub:o,notifyNestedSubs:c,handleChangeWrapper:a,isSubscribed:g,trySubscribe:m,tryUnsubscribe:d,getListeners:()=>i};return f}var de=()=>typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",ue=de(),fe=()=>typeof navigator<"u"&&navigator.product==="ReactNative",pe=fe(),he=()=>ue||pe?l.useLayoutEffect:l.useEffect,ve=he(),x=Symbol.for("react-redux-context"),y=typeof globalThis<"u"?globalThis:{};function ge(){if(!l.createContext)return{};const e=y[x]??(y[x]=new Map);let t=e.get(l.createContext);return t||(t=l.createContext(null),e.set(l.createContext,t)),t}var v=ge();function me(e){const{children:t,context:s,serverState:i,store:n}=e,r=l.useMemo(()=>{const a=le(n);return{store:n,subscription:a,getServerState:i?()=>i:void 0}},[n,i]),o=l.useMemo(()=>n.getState(),[n]);ve(()=>{const{subscription:a}=r;return a.onStateChange=a.notifyNestedSubs,a.trySubscribe(),o!==n.getState()&&a.notifyNestedSubs(),()=>{a.tryUnsubscribe(),a.onStateChange=void 0}},[r,o]);const c=s||v;return l.createElement(c.Provider,{value:r},t)}var tt=me;function C(e=v){return function(){return l.useContext(e)}}var V=C();function W(e=v){const t=e===v?V:C(e),s=()=>{const{store:i}=t();return i};return Object.assign(s,{withTypes:()=>s}),s}var H=W();function Se(e=v){const t=e===v?H:W(e),s=()=>t().dispatch;return Object.assign(s,{withTypes:()=>s}),s}var be=Se(),xe=(e,t)=>e===t;function ye(e=v){const t=e===v?V:C(e),s=(i,n={})=>{const{equalityFn:r=xe}=typeof n=="function"?{equalityFn:n}:n,o=t(),{store:c,subscription:a,getServerState:g}=o;l.useRef(!0);const h=l.useCallback({[i.name](m){return i(m)}}[i.name],[i]),u=oe.useSyncExternalStoreWithSelector(a.addNestedSub,c.getState,g||c.getState,h,r);return l.useDebugValue(u),u};return Object.assign(s,{withTypes:()=>s}),s}var Ce=ye();const we={size:{row:3,col:4},lots:Array.from({length:6},()=>({id:G(4)}))},j=p({name:"AreaTiles",initialState:we,reducers:{setState(e,{payload:t}){Object.assign(e,t)},placeLot(e,{payload:{lotId:t,position:s}}){const i=e.lots.find(n=>n.id===t);i&&(i.position=s)}}}),st=j.actions,ke={cards:[],blockFlipping:!1,blockActivating:!1,flippedCards:[]},z=p({name:"CardSelect",initialState:ke,reducers:{setState(e,{payload:t}){Object.assign(e,t)},addFlippedCard(e,{payload:t}){e.flippedCards.find(i=>i.id===t.id)||e.flippedCards.push(t)}}}),Ee={cards:[],validMatchers:[],invalidMatchers:[],completedMatchers:[]},U=p({name:"memoCards",initialState:Ee,reducers:{setState(e,{payload:t}){Object.assign(e,t)},serve(e,{payload:t}){(Array.isArray(t)?e.cards.filter(i=>t.includes(i.id)):e.cards.filter(i=>i.status==="decked").slice(-t.count)).forEach(i=>{i.status="served"})},highlight(e,{payload:t}){e.cards.filter(s=>t.includes(s.id)).forEach(s=>{s.highlighted=!s.highlighted})},elevate(e,{payload:t}){e.cards.filter(s=>t.includes(s.id)).forEach(s=>{s.elevated=!0})},shake(e,{payload:t}){e.cards.filter(s=>t.includes(s.id)).forEach(s=>{s.shaking=!s.shaking})},blockLowering(e,{payload:t}){e.blockLowering||(e.blockLowering=[]),e.blockLowering.push(...t)},lower(e,{payload:t}){e.cards.filter(s=>t.includes(s.id)).forEach(s=>{s.elevated=!1})},select(e,{payload:t}){(t?e.cards.filter(i=>t.includes(i.id)):e.cards.filter(i=>i.elevated)).forEach(i=>{i.status="selected"})},deselect(e,{payload:t}){if(Array.isArray(t)){e.cards.filter(o=>t.includes(o.id)).forEach(o=>{o.status="served",o.elevated=!1,delete o.correct});return}const s=t==null?void 0:t.ids,i=(t==null?void 0:t.keepCorrect)||[];(s?e.cards.filter(r=>s.includes(r.id)):e.cards.filter(r=>r.status==="selected")).forEach(r=>{r.status="served",r.elevated=!1,i.includes(r.id)||delete r.correct})},validate(e,{payload:t}){t.forEach(({id:s,correct:i})=>{const n=e.cards.find(r=>r.id===s);n&&(n.correct=i)}),delete e.validate},discard(e,{payload:t}){let s=e.cards;t==="selected"?s=s.filter(i=>i.status==="selected"):Array.isArray(t)?s=s.filter(i=>t.includes(i.id)):s=s.filter(i=>["served","selected"].includes(i.status)),s.forEach(i=>{i.status="discarded",delete i.elevated,delete i.highlighted,delete i.correct})}}}),Ie={text:[],coins:[]},_=p({name:"memoCardsExplanation",initialState:Ie,reducers:{setState(e,{payload:t}){Object.assign(e,t)}}}),Me={text:`
    <div>Показания подозреваемого: "У меня алиби! Я вышел из музея раньше момента совершения преступления, ведь мне надо было <highlighted><operand id="total4">4</operand> часа</highlighted> добираться домой: сначала <highlighted><operand id="foot2h">2</operand> часа я шёл пешком</highlighted> и проходил по <highlighted><operand id="foot5kmh">5</operand> километров</highlighted> каждый час, потом <highlighted><operand id="scooter2h">2</operand> часа ехал на электросамокате</highlighted> - по <highlighted><operand id="scooter25kmh">25</operand> километров каждый час</highlighted>."</div>
    <div><strong>Сколько километров проехал подозреваемый, если его рассказ - правда?</strong></div>
  `,showSolution:!1,solution:{steps:[{label:"Шаг 1",expression:[{type:"slot",item:{variant:"operand",id:"step0slot0",accepts:["drop"]}},{type:"slot",item:{variant:"sign",id:"step0slot1",accepts:["drop"]}},{type:"slot",item:{variant:"operand",id:"step0slot2",accepts:["drop"]}},{type:"sign",item:{variant:"equals"}},{type:"slot",item:{variant:"operand",id:"step0slot3",accepts:[]}}]},{label:"Шаг 2",expression:[{type:"slot",item:{variant:"operand",id:"step1slot0",accepts:["drop"]}},{type:"slot",item:{variant:"sign",id:"step1slot1",accepts:["drop"]}},{type:"slot",item:{variant:"operand",id:"step1slot2",accepts:["drop"]}},{type:"sign",item:{variant:"equals"}},{type:"slot",item:{variant:"operand",id:"step1slot3",accepts:[]}}]},{label:"Шаг 3",expression:[{type:"slot",item:{variant:"operand",id:"step2slot0",accepts:["drop"]}},{type:"slot",item:{variant:"sign",id:"step2slot1",accepts:["drop"]}},{type:"slot",item:{variant:"operand",id:"step2slot2",accepts:["drop"]}},{type:"sign",item:{variant:"equals"}},{type:"slot",item:{variant:"operand",id:"step2slot3",accepts:[]}}]}],activeStepIndex:0}},w=p({name:"TextProblem",initialState:Me,reducers:{setState(e,{payload:t}){Object.assign(e,t)},placeToken(e,{payload:t}){const{slotId:s,token:i}=t,n=e.solution.steps.map(r=>r.expression).flat().find(r=>r.type==="slot"&&r.item.id===s);(n==null?void 0:n.type)==="slot"&&(n.item.token=i)},dropToken(e,{payload:t}){const{stepIndex:s,tokenId:i}=t,n=e.solution.steps[s];n&&n.expression.forEach(r=>{var o;r.type==="slot"&&((o=r.item.token)==null?void 0:o.id)===i&&delete r.item.token})},setStep(e,{payload:t}){e.solution.activeStepIndex=t},redoStep(e,{payload:t}){e.solution.steps.slice(t).forEach(i=>i.expression.forEach(n=>{n.type==="slot"&&delete n.item.token}))},setSlotInput(e,{payload:t}){const{slotId:s,accepts:i,inputTokenId:n}=t,r=e.solution.steps.map(o=>o.expression).flat().find(o=>o.type==="slot"&&o.item.id===s);(r==null?void 0:r.type)==="slot"&&(r.item.accepts=i,n&&(r.item.inputTokenId=n))}}}),it=w.actions,Ae={},k=p({name:"action",initialState:Ae,reducers:{setAction(e,{payload:t}){const{variant:s,prop:i,text:n,next:r,options:o}=t;e.variant=s,e.prop=i,e.text=n,e.next=r,e.options=o},resetAction(e){delete e.variant,delete e.prop,delete e.text,delete e.next,delete e.options}}}),{setAction:nt,resetAction:rt}=k.actions,Oe={messages:[]},E=p({name:"chat",initialState:Oe,reducers:{pushMessage(e,{payload:t}){e.messages.unshift(t)},pinMessage(e,{payload:t}){const s=e.messages.find(i=>i.id===t);s&&(s.pinned=!0)},unpinMessage(e){const t=e.messages.find(s=>s.pinned);t&&(t.pinned=!1)}}}),{pushMessage:ot,pinMessage:at,unpinMessage:ct}=E.actions,Pe={},I=p({name:"interactive",initialState:Pe,reducers:{attachInteractive(e,{payload:t}){e.component=t.component,e.triggers=t.triggers},detachInteractive(e){delete e.component,delete e.triggers},setTriggers(e,{payload:t}){e.triggers=Object.assign(e.triggers||{},t)}}}),{attachInteractive:lt,detachInteractive:dt,setTriggers:ut}=I.actions,Te={sections:[],activeSection:0},M=p({name:"progress",initialState:Te,reducers:{initProgress(e,{payload:t}){e.sections=t.sections,e.activeSection=t.activeSection},setActiveSection(e,{payload:t}){e.activeSection=t},setProgress:(e,{payload:t})=>{const s=e.sections[e.activeSection];s.rate=t/s.total*100},completeSection:e=>{e.sections[e.activeSection].completed=!0}}}),{initProgress:ft,setActiveSection:pt,setProgress:ht,completeSection:vt}=M.actions;function F(e,t,s){t=="__proto__"&&P?P(e,t,{configurable:!0,enumerable:!0,value:s,writable:!0}):e[t]=s}var $e=Object.prototype,Re=$e.hasOwnProperty;function K(e,t,s){var i=e[t];(!(Re.call(e,t)&&J(i,s))||s===void 0&&!(t in e))&&F(e,t,s)}function Le(e,t,s,i){var n=!s;s||(s={});for(var r=-1,o=t.length;++r<o;){var c=t[r],a=void 0;a===void 0&&(a=e[c]),n?F(s,c,a):K(s,c,a)}return s}function De(e){return Q(function(t,s){var i=-1,n=s.length,r=n>1?s[n-1]:void 0,o=n>2?s[2]:void 0;for(r=e.length>3&&typeof r=="function"?(n--,r):void 0,o&&X(s[0],s[1],o)&&(r=n<3?void 0:r,n=1),t=Object(t);++i<n;){var c=s[i];c&&e(t,c,i,r)}return t})}function Ne(e,t){return function(s){return e(t(s))}}var Ve=Ne(Object.keys,Object),We=Object.prototype,He=We.hasOwnProperty;function je(e){if(!R(e))return Ve(e);var t=[];for(var s in Object(e))He.call(e,s)&&s!="constructor"&&t.push(s);return t}function ze(e){return L(e)?Y(e):je(e)}var Ue=Object.prototype,_e=Ue.hasOwnProperty,Fe=De(function(e,t){if(R(t)||L(t)){Le(t,ze(t),e);return}for(var s in t)_e.call(t,s)&&K(e,s,t[s])});const Ke={events:[],context:{},watchers:{},styles:{},idles:{},confetti:!1,meme:"",smartik:"proud",comics:null,sideSlide:null},A=p({name:"tutor",initialState:Ke,reducers:{pushEvent(e,{payload:t}){e.events.push(t)},extendContext(e,{payload:t}){e.context={...e.context,...t}},addWatcher(e,{payload:t}){const{name:s,matchers:i}=t;e.watchers[s]=i},removeWatcher(e,{payload:t}){delete e.watchers[t]},showMeme(e,{payload:t}){e.meme=t},hideMeme(e){e.meme=""},setStyles(e,{payload:t}){Fe(e.styles,t)},addIdle(e,{payload:t}){const{name:s,next:i,delay:n}=t;e.idles[s]={next:i,delay:n}},showConfetti(e){e.confetti=!0},hideConfetti(e){e.confetti=!1},removeIdle(e,{payload:t}){delete e.idles[t]},offerHelp(e,{payload:t}){e.help=t},resetHelp(e){delete e.help},smartikState(e,{payload:t}){e.smartik=t},showComics(e,{payload:t}){e.comics={slides:(t==null?void 0:t.slides)||[],id:t==null?void 0:t.id}},hideComics(e){e.comics=null},showSticker(e,{payload:t}){e.sticker=t},hideSticker(e){delete e.sticker},showSideSlide(e,{payload:t}){e.sideSlide=t},hideSideSlide(e){e.sideSlide=null}}}),gt=(e,t)=>s=>{s(Ge(e)),setTimeout(()=>{s(Je())},t)},mt=e=>t=>{t(qe()),setTimeout(()=>{t(Be())},e)},St=(e,t)=>s=>{s(Qe(t)),setTimeout(()=>{s(Xe())},e)},{pushEvent:bt,extendContext:xt,addWatcher:yt,removeWatcher:Ct,setStyles:wt,addIdle:kt,removeIdle:Et,offerHelp:It,resetHelp:Mt,showConfetti:qe,hideConfetti:Be,showMeme:Ge,hideMeme:Je,smartikState:At,showComics:Ot,hideComics:Pt,showSticker:Qe,hideSticker:Xe,showSideSlide:Tt,hideSideSlide:$t}=A.actions,Rt={CardSelect:z,MemoCards:U,MemoCardsExplanation:_,TextProblem:w},q={action:k.reducer,chat:E.reducer,interactive:I.reducer,progress:M.reducer,tutor:A.reducer,CardSelect:z.reducer,MemoCards:U.reducer,MemoCardsExplanation:_.reducer,TextProblem:w.reducer,AreaTiles:j.reducer};$({reducer:q});const Lt=be.withTypes(),Dt=Ce.withTypes();H.withTypes();const Nt=(e={})=>$({reducer:q,preloadedState:{action:k.getInitialState(),chat:E.getInitialState(),interactive:I.getInitialState(),progress:M.getInitialState(),tutor:A.getInitialState(),...e}});export{At as A,at as B,ct as C,It as D,Mt as E,Ot as F,St as G,Tt as H,$t as I,Rt as J,bt as K,U as L,it as M,ht as N,Pt as O,tt as P,Fe as Q,Dt as a,st as b,K as c,Le as d,F as e,je as f,De as g,ot as h,xt as i,ft as j,ze as k,nt as l,lt as m,dt as n,Ne as o,Nt as p,ut as q,rt as r,wt as s,yt as t,Lt as u,gt as v,Ct as w,kt as x,Et as y,mt as z};
